"use strict";var e=require("path"),s=require("glob"),r=require("mini-css-extract-plugin"),t=require("webpack"),n=require("vue-loader"),o=require("vue"),i=require("@vue/server-renderer"),a=require("fs"),l=require("chalk"),c=require("webpack-dev-server");const{version:u,author:p}=require(e.resolve("package.json")),v=`/*!\n * [name] v${u}\n * Copyright (c) 2019-${(new Date).getFullYear()} ${p}\n * ${(new Date).toString()}\n * All rights reserved.\n */`;var h=[new t.BannerPlugin(v),new n.VueLoaderPlugin,new r({moduleFilename:({name:s})=>e.join(s,"../../css/"+e.basename(s)+".css?v=[Hash]")}),new class{constructor(e){this.options=e}apply(e){this.entry=e.options.entry;const s=this.emitCallback.bind(this);e.hooks?e.hooks.emit.tap("ExtHtmlWebpackPlugin",s):e.plugin("emit",s)}emitCallback(s,r){const t=this.entry,n=e.resolve(this.options.template),l=require(e.resolve(this.options.assetsconfig));s.chunks.forEach((r=>{const c=e.basename(r.name),u=e.resolve(t[r.name],"../import.json"),p=this.options.extFilename.replace("[name]",c),v=e.join(r.name,p);var h={title:"云僖",css:[],js:[],pushSrc(e){let s=e.substring(e.lastIndexOf(".")+1);const r=s.indexOf("?");r>0&&(s=s.substring(0,r)),this.hasOwnProperty(s)&&this[s].push(e)}};if(a.existsSync(u)){h.initial=[];const t=require(u);t.plugin&&t.plugin.forEach((e=>{let s=l[e]||e;"object"==typeof s?s.forEach((e=>{h.pushSrc(e)})):h.pushSrc(s)})),r.files.forEach((s=>{s=e.posix.resolve("/",s),h.pushSrc(s)}));const c=a.readFileSync(n,"utf-8"),p="<!DOCTYPE html>",m={data:()=>({cssFile:h.css}),template:'<link v-for="css in cssFile" rel="stylesheet" :href="css">'},d={data:()=>({jsFile:h.js}),template:'<script v-for="js in jsFile" :src="js"><\/script>'},g=o.createApp({components:{css:m,js:d},data:()=>h,template:c});(async()=>{const e=p+await i.renderToString(g);s.assets[v]={source:()=>e,size:()=>e.length}})()}})),r&&r()}}({template:"template.html",assetsconfig:"cdn.config.json",extFilename:"../../[name].html"})];const m="src",d="/",g=e.join(m,d);var f=function(){const r=e.join(g,"**/main.js");var t={};return s.sync(r).forEach((function(s){let r=e.basename(e.join(s,"../"));r=e.join(s,"../../js/",r),r=e.relative(m,r),t[r]="./"+s})),console.table(t),"{}"==JSON.stringify(t)&&(console.error(l.yellow("没有文件被打包")),process.exit()),console.log(l.bgBlue(`正在打包源码目录:${g}`)),t}();const j=process.cwd();var b={mode:"production",devtool:"#source-map",entry:f,output:{path:e.resolve(j,"dist"),filename:"[name].js?v=[Hash]"},externals:{vue:"Vue","vue-router":"VueRouter",echarts:"echarts",uimi:"uimi"},plugins:h,module:{rules:[{test:/.jsx?$/,include:[e.resolve(j,m)],exclude:[e.resolve(j,"node_modules")],loader:"babel-loader"},{test:/\.vue$/,loader:"vue-loader"},{test:/\.s[ac]ss$/i,use:[r.loader,"css-loader","sass-loader"]}]},devServer:{open:!0,port:"81",contentBase:e.resolve(j,"dist")},resolve:{extensions:[".js",".vue",".css",".scss",".json"],alias:{components:e.resolve("src/components")}}};const y=t(b);if(process.argv.includes("build")&&y.run(((e,s)=>{})),process.argv.includes("server")){const e=b.devServer;new c(y,e).listen(e.port,"127.0.0.1",(()=>{console.log("Starting server on http://localhost:"+e.port)}))}
